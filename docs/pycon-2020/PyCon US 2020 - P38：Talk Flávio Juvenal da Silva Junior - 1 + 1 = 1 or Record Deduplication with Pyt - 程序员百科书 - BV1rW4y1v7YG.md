# PyCon US 2020 - P38：Talk Flávio Juvenal da Silva Junior - 1 + 1 = 1 or Record Deduplication with Pyt - 程序员百科书 - BV1rW4y1v7YG

![](img/fb87274cbfd2e1d968d7fdc0f4d53441_0.png)

大家好，我爱你，Juvenal，我今天会和你们讨论 一加一等于一，或者与蟒蛇的复制，我真的很荣幸能成为蟒蛇的一员，二千二，我的背景是 我是华盛顿州的合伙人，我们是来自巴西的网络咨询公司。

与世界各地的客户合作，做贾戈开发，我们也在里面记录了这些重复，这里的决议工作是我的推特手柄，flayour，少年，如果你想跟踪我 了解复制项目的消息，我的项目很有趣，这些幻灯片是木星笔记本。

所以你可以在这个 github repo查看它们，你也可以在你自己的机器上复制结果，如果你想，记录删除背后的动机是什么，现实世界的数据一团糟，可能你以前处理过这样的数据，我们这里有，餐馆的名字。

数据上明显有人类的重复，我们可以很容易地看到这一点，但电脑要想弄清楚这一点并不那么简单，因为地址和名字都有变化，解决办法是执行复制，也称为记录链接和实体解析，复制工作是通过融合的方式将记录连接在一起。

使用像名字这样的数据，其他的数据不能唯一地识别人或公司，但通过未来的方式加入其中，我们就能找出复制记录的方法，所以让我们来谈谈融合相似性和数据清洁，您可以通过使用编辑距离来使用一对字符串的相似性。

这里我们使用一个叫做 pi字符串匹配的库，我们用的是闪电时间算法，所以我们计算这两个字符串之间的编辑距离，它们代表着同样的东西，但是对于非常相似的名字来说，零十六的相似性太小了。

这里的问题是代币有不同的顺序，餐厅名称的文字是一个试探性的相似性度量，我们可以使用忽略令牌顺序，是的，蒙克·埃隆是我们的名字，在同一个图书馆里，它使用一个内部相似性函数计算所有标记，奥肯对。

这样我们就可以忽略代币的顺序，我们在这里得到了更高的相似性 它起作用了，但这里仍有改进空间，咖啡馆如何摆脱尖锐的口音，因为我们想在这两根弦上找到一个相似的地方，因为它们的意思是一样的。

我们可以使用一个名为 unity code的库来清除重音，现在我们可以申请更多的孩子，我们得到了一个我们正在寻找的相似之处，也许我们可以考虑将名称高度相似的餐厅模式作为匹配。

但是对于地址使用其他字段也很有用，您可以通过首先对它们进行地理编码来使用相似性，所以我们用图书馆的地理编码器，它将调用谷歌地理编码器到带有 on的地理编码地址，把运气带到经度。

在这里我们得到了这些地址的纬度，然后我们可以计算出我们使用的地址之间的距离，有一个场景，它会告诉我们，两者之间的距离导致了发射，我们可以考虑到足够接近的地址，所以让我们比较一下我们的餐厅对。

现在使用这些函数来比较名字，为了比较地址，将一切与一切进行比较，这是我们的数据集，餐厅数据集，所以我们找到了我们的数据集，有很多东西要买，我们会把我们的记录，我们有6张唱片，身份证零到五。

我们会计算出所有可能的配对，我们将使用使用组合，所以如果我通过和2并通过索引，我去拿所有的双鞋，这个数据集中所有可能的对，那是十五双，因为我有六个工人生产15双，检查其中一些对，是啊，他们看起来很好。

我们会比较我们的客人，现在我们将对表示为 dicrecords 对，那对我们会更好，所以我们把它从一个数据帧转换为一个 dict对列表，像这样，我们会这样做，因为我们会创建评分函数。

比较每个记录中的字段，所以我有一个功能来比较名字，一对火焰，x，y，我会用更多的果酱，我将把它与两对纬度进行比较，摩托和我失去了收获，我将使用这两个函数并返回一个结果作为 dict。

这将是我先前的比较函数，当我运行的时候，我明白了，这个示例对的名称和遥远地址的相似性很低，所以很明显现在不匹配了，让我们用这个函数给所有的对打分，这是一些紫罗兰，去做这件事，这就是我们得到的。

我们得到了一个数据框架，它有名字对的分数，喜欢知识对知识，所以对于0到1，从0到2，这种情况还在继续，让我们过滤分数数据帧 以寻找匹配，我们将过滤分数高于点5和门闩，彼此相距不到一公里。

我们得到了正确的配对，我们正在寻找匹配的配对，零，一，二三，四和五，这在这里是基于规则的方法，从稀疏中找出匹配，以下是匹配理论，你正在寻找的六张唱片 很好地将所有的唱片与所有的唱片进行比较。

我们有15双，但对于一百万张唱片来说，例如，我们会得到近五千亿双，如果我们比较一下我们的安装，随着唱片数量的增长，成对的数量增长得太快了，根据这个公式，它呈二次方增长，为了避免浪费太多时间。

对比很多票价，我们需要封锁，否则将需要数年时间来运行一些记录链接，复制工作，我们只需要制造一对好的，被重复的候选人，这就是阻挡的作用，只生产好的一对，很可能是重复的，让我们了解指纹和阻断。

什么是屏蔽名字的好方法，以下是 SQL数据集的名称，我们需要一个指纹功能来清除不相关的名字变化，所以像这样的事情，我知道名字了，我去掉口音，我把它小写了，我开始代币，我删除了埃里克身上所有有趣的东西。

任何不是字母或数字的东西，我取下这个名字的指纹，这是这个指纹的应用，所有的名字，所以这个看起来不错，因为这两个不同的名字有相同的指纹，当我按下那个指纹，我得到了我需要得分的双，为了弄清它们是否匹配。

在这种情况下，它甚至不需要得分，因为这些恰恰是匹配的，我们一起封锁了，不同的餐厅名称与我们的指纹功能，这就是阻挡的作用，以下是一些可以用于阻止的指纹功能的例子，你可以订购代币，你可以拿一个普通的代币。

没有什么能阻止你在同一记录上有多个指纹，这 也很有用，你可以猜到第一个 n个代币，你可以得到一个前缀，缩略语编码在某些数据集上可以很好地工作很多，这太过分了，你可以得到一个网格，你可以得到臀部。

数字的地理哈希，你可以试试数量级，你们一起阻止，具有相似或相同数量级的数字，其他类型的数据，你还有其他的指纹功能，但是什么类型的图形打印会把近似的匹配拼凑在一起，就像哈维斯，咖啡馆和哈弗斯。

在我们的咖啡上，这不完全匹配，很难把这些联系在一起，我们可以尝试近似阻断，近端锁定在密度分辨率方面是一个具有挑战性的领域，一个好的近似阻塞函数 能够将相似的对阻塞在一起，不诉诸所有的比较。

所以我不需要通过不这样做来比较所有人，我有其他方法把相似的东西组合在一起，类似记录，这里有一个例子，我有一些名字，它们之间有些变化，我在这里调用一个阻滞剂函数，指纹功能，能够从这些名字中找到正确的区块。

我不会在这里得到太多关于这是如何工作的细节，但你可以查看这些资源，敬请关注，在这个博客中，我将在approate上发表实验，把最近的邻居挡住了，这就是我对那些有这种功能的人所做的，我给你看。

关于本地敏感的散列也有很好的资源，它是一种哈希函数，可以优化类似数据上的冲突，与普通功能完全相反，是啊，您不希望在一个常见的哈希函数上发生碰撞，但是呃，论局部敏感哈希，有碰撞是好事。

因为这样你就可以把相似的数据分组 而不用比较，阿拉出局，请查看其他资源，好的，现在我们可以很好地阻止，我们能在匹配和不匹配的分类上做得更好吗，是的，让我们学习一点围棋，记住。

我们只是用了一个简单的规则来将我们的配对归类为匹配，我们只是得到了大于或等于零点的东西，五个命名的相似性和不到一公里的距离，就像一对的发射，我们得到了正确的配对，可以很好地处理序列小数据集。

但对于复杂和较大的，机器学习分类器可能会工作得更好，所以我们想要这样的东西，我们要传递卡片数据，框出一个商店列表，并找出匹配的对，分类器会计算出分数，分数对，匹配的对，真正代表重复工作的匹配的。

问题是如何训练分类器，在一个巨大的数据集中 手动寻找匹配的对 可能是很有挑战性的，因为匹配对的数量往往比不匹配的少得多，配对，我们可以用主动学习来解决这个问题，解释 主动学习。

我们使用基于餐厅数据集的库尔森数据集，这是一个众所周知的数据集，它有三到一家餐馆的记录，一共一百五十份，这是餐厅的数据集，有特别的名字，地址，CD，电话，餐厅类型和集群柱，它代表了这个数据数据的真相。

其实是同一家餐厅，所以那些是，这里有副本，所以我们可以得到像黄金对，通过查看集群列 表示此数据集重复的对，所以我们按群列分组，抓住指数，找出配对的组合，此数据集的黄金对，一百五十。

我们删除了电话和类型字段，使事情变得更加困难，因为好玩，这是一场轻松的比赛，所以我们也删除了那个类型，所以我们只剩下名字了，其他的和这个数据集里的 cd，我们会跳到地址上，所以我们也得到了地址。

我们也会从谷歌得到抓取邮件，因为邮政编码很有用，我们能从谷歌获得更多的数据 真的很好，不仅锁的最多，但我们也可以用地理密码和邮政编码，你也可以尝试谷歌以外的 geholders，外面还有免费的。

名为d two的python库实现了主动学习，并具有友好的界面，所以让我们看看在实践中，我将传递给做的领域，所以受骗者会在那些田地里工作，姓名，是一根绳子，是一根绳子，同时也是一根绳子。

做得不多也不算多，我把它初始化为公爵，我会通过标记匹配和不匹配的例子来训练杜，它要求我们，所以这段代码被注释了，因为我现在不想运行这个输出，所以你准备训练，从那个家伙开始 你的控制台标签。

它所做的是一个命令行界面，在那里你可以说，如果熊，它问你要不要我们的火柴，所以在这里它向我要这双，排场比赛，因为这里的一切都吻合，所以我答应了，他的另一个爸爸，我说是的，然后它一直要求我们配对。

因此我们要制作一套，这就是学习，让我们在这里听另一个匹配的例子，到目前为止，只有火柴，但现在有了这个名字，另一个不同的名字，但街道还是一样，对大多数人来说，命运是一样的，但名字不一样，所以不匹配。

然后我们可以继续，直到我们累了，或者直到我们认为父母需要你问我们，很好地代表了我们的数据集，培训后，我们可以看到骗子从我们的训练输入中学到了哪些屏蔽指纹，这样做很好，以检查，如果我们训练他们。

所以当我检查 我学会了，你决定这个名字的第一个标志，同样，名字的前七个字符一起表示一个阻塞规则，指纹，所以你是通过名字的第一个标记来提取数据的指纹，也一样，名字的七个字，所以这里没有名字。

当你看到相同的，结束了，所以这是一个结合了第一个标记和同一个标记的组合指纹，名字的七个字，但它也有其他指纹，你这里有一个或，所以这是一个结束，也不符合另一个阻塞规则，另一个指纹通常是邮政的埃里克谓词。

基本上是准确的 邮政和其他人名字的第一个积分，所以这是有意义的，因为它挡住了一起，名字和地址相似的东西，它甚至发现其他的第一个积分真的是相关的，因为它是街道的号码，是其他街道的号码，所以很不错。

因为它对我们的数据有所了解，我们学习如何阻止我们的数据，是骗子，从这些可能的指纹的紧张提升中选择这些指纹，它已经带有多个指纹的计算来尝试您的数据，它尝试他们，根据你的训练设置 你的训练对，它选择最好的。

最好的拦网规则，能很好地屏蔽你数据的最好指纹，在没有比较很多对的情况下，但也包括可能的配对，进行新的重复，我们计算块和对，所以我们在训练后得到了我们所说的杜珀点对，我们称我们的，我们得到了块对。

那些是成双成对的块，其中一个在，然后我们将这些阻滞剂对内部分类，看起来是这样的，我们有拦截器对，它计算距离，我们抓住这个，那些距离，那些相似之处，然后骗子使用一个分类器 比如机器学习分类器，在本例中。

我们使用的是雨林分类器，如果你愿意，你可以检查代码，我们把这个分类器叫做分数上的分类器，相似的地方，距离，我们拿到分数，这不是我们领域的分数，但只有一个分数代表，如果，如果那一对是匹配的还是不匹配的。

所以我们称之为两点得分，螺丝是在0和1之间的浮动，这表明这对中的记录有多相似，当我打电话的时候 我得到了这个，我得到了一个矩阵，上面有对和漂浮的，如果匹配与否，所以这些可能是匹配的。

这个可能不是匹配的纸条，我们车上有相似度极低的记录，更好的结果就像六七相似，零点零四，我们需要一个阈值来过滤掉低相似性对，我们把门槛定在五个，我们用阈值过滤这些平方对，我们得到了匹配的阈值路径 对。

理解阈值允许我们在精确和召回之间进行权衡，请，如果你不知道你的使命是什么，请按此处，维基百科上有很好的解释，那就是试着对匹配的记录或多或少地敏感，冒着引入假阳性的风险，如果你比较敏感或者是假阴性。

如果你不那么敏感，现在我们评估它的表现，我们设置了门槛对，我们检查，把它们和我们的黄金佩核对一下，对于真正积极的人来说，这是一个相当好的结果，真正匹配的东西，我们发现我的两个九个只有三个假阳性。

骗子认为更匹配或不匹配的东西，和假阴性修复，做的事情，你不认为是匹配的，但是是，但这是匹配的，这些东西在我们的阈值对情况下是一致的，在程序和召回方面，这些就是结果。

大多数教程都认为这个问题在这一点上已经解决了，但还是少了点什么，集群，以下通常发生在您分类成对之后，我们有记录，通过消除重复，我们发现 b是匹配的，BC是匹配的，a c，是一种敬意，这没有意义。

因为那是个三角形，它应该关闭，所以是吻合的，BNC是匹配的，所以 c也应该是匹配的，这些东西应该是可传递的，解决这个歧义的方法是计算传递闭包，通过集群和。

dupecan集群 我们的记录 如果我们调用分区，与其祈祷，加车和 d一样，如果我们调用直接分区，它会从数据中得到星系团，所以这些是星团，他们不再模棱两可了，因为他们是，他们更近，不是不是对。

我们得到了正确的结果，我们想让记录的东西代表同一个现实世界的实体，我们复制了这里的记录，我们没有得到的人，但是我们把星团从，现在我们得到了集群对，所以我们必须把每一个内部的组合都弄得更近 才能得到。

越近越好，我们对这些簇对和未簇对进行了比较，当我们这样做的时候，我们看到集群的真正积极因素，集群对大于非 集群对，在附加修复中也少了一个假阳性，这很有趣，你做的手术显然也不一样。

因为非集群对与集群对不同，不需要解决传递闭包，注，游标进程可以创建新的匹配项，也可以删除已找到的匹配项，所以如果我们取这两组之间的对称差，我们看到上面有不同的对，我们分析一下这些配对，所以这里我有一些。

分析这些数据的蓝色代码，我得到的是这4张唱片，它们代表着同样的东西，同样的现实世界，所以事实是，他们都应该像这样联系在一起，更接近的版本告诉我们 这里有一个缺失的边缘，骗子不能泄露这张唱片。

三四到这个记录，也就是说，当我聚集在一起，我得到了缺失的边缘，所以这很好，我们创造了一个优势，因甘油失踪，我们消除了一个模糊性，因为这没有意义，如果所有这些东西，但这个也应该匹配。

或者你至少应该去掉一些边缘来去掉这个安比古，在另一个案例中 真相是，这里什么都不应该匹配，一切都不一样，他们的困惑，因为地址是一样的，但什么都不应该匹配，名字很不一样，所以事实是这些记录之间没有联系。

当我得到群集对，我明白了，所以有联系，这里还缺少一个环节，但集群版本做到了这一点，它消除了一个边缘，这很好，因为我在这里删除了一个假阳性，不应该修补的东西，但我在这里还是保持了错误的边缘，如此接近。

可以这样做，并与它可以解决的问题，我会和问题在一起，但这解决不了我们的假阳性问题，很明显 因为它聚集了，但这是不能保留的，但它消除了，好的，所以我们完成了复制工作，下一步将采取什么措施。

如果我想知道更多关于复制的信息，确保您了解其他预处理方法，索引技术，如函数，分类器，看看这篇演讲，看看这本书，数据匹配是一本非常好的书，它概述了这种反分辨率，经常外地，敬请关注我的博客。

我会在副本上发布额外的内容，人们通常会问，一旦我们得到了集群，5。我们将如何把许多记录中的数据综合起来，你可以检查聚变数据上的材料，人们经常问我们，如果新的记录到达怎么办。

我们应该结婚结婚结婚搬家记录从集群，为了解决增量记录链接上的检查材料，你在地名录类中支持这一点吗？但也有其他方法，请检查是否值得讨论 记录链接的隐私影响，有一章是关于数据匹配的书，谈论那个。

您可以使用一些概念来确保记录上的隐私链接差异 隐私，例如，你可以查一下丽贝卡莎莉，先谈隐私，在这个会议上有金属来了解更多关于那些，但即使你有办法保证隐私，该决议具有伦理含义，对隐私可能不那么酷。

保存我们的笔记，允许我还没有准备好保护人们的隐私，从先进的分辨率记录链接技术，所以拜托，请不要把不想被联系的人联系起来，也不要把记录和人们联系起来，我在这里开餐厅的原因，因为我不想用别人的数据。

即使是公开的数据，那些人可能不想和我们的技术联系在一起，以下是这次演讲的参考资料，上面也有你可以检查的，非常感谢，这是我的邮件，如果您有任何关于记录链接的问题，或者如果你有关系项目。

我也很想听到更多关于他们的信息，这是我的推特，把手，我公司的网站，特别感谢那些帮助我准备这次演讲的人，并让它进入一个伟大的状态，我认为它是现在，所以请随时联系我，如果你有任何问题。



![](img/fb87274cbfd2e1d968d7fdc0f4d53441_2.png)